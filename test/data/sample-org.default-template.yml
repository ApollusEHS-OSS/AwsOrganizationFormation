AWSTemplateFormatVersion: '2010-09-09-OC'
Description: default template generated for organization with master account 588583220729

Organization:
  Root:
    Type: OC::ORG::MasterAccount
    Properties:
      AccountName: Moneyou Organizational Master Account
      AccountId: '588583220729'

  ProductionOU:
    Type: OC::ORG::OrganizationalUnit
    Properties:
      OrganizationalUnitName: production
      ServiceControlPolicies: !Ref DenyUnsupportedRegionsSCP
      Accounts:
        - !Ref MoneyouAddressbookProductionAccount
        - !Ref MoneyouLimitsProductionAccount
        - !Ref MoneyouXS2AProductionAccount
        - !Ref MoneyouDataProductionAccount
        - !Ref MoneyouAuthproductionAccount
        - !Ref MoneyouTransferBankProductionAccount
        - !Ref Xs2a-devportalAccount
        - !Ref MoneyouOnboardingProductionAccount
        - !Ref MoneyouSnowplowProductionAccount
        - !Ref MoneyouWalletsProductionAccount

  DevelopmentOU:
    Type: OC::ORG::OrganizationalUnit
    Properties:
      OrganizationalUnitName: development
      ServiceControlPolicies: !Ref DenyUnsupportedRegionsSCP
      Accounts:
        - !Ref MoneyouTeam3DevelopmentAccount
        - !Ref MoneyouTaiichiDevAccount
        - !Ref MoneyouDataDevelopmentAccount
        - !Ref MoneyouSandboxDevAccount
        - !Ref Moneyou403DevAccount
        - !Ref MoneyouTeam2DevelopmentAccount
        - !Ref MoneyouTeam1DevelopmentAccount
        - !Ref MoneyouFreshDevelopmentAccount

  SharedOU:
    Type: OC::ORG::OrganizationalUnit
    Properties:
      OrganizationalUnitName: shared
      ServiceControlPolicies: !Ref DenyUnsupportedRegionsSCP
      Accounts:
        - !Ref MoneyouPlatformAccount
        - !Ref MoneyouSecurityAccount
        - !Ref MoneyouComplianceAccount
        - !Ref MoneyouLoggingAccount
        - !Ref MoneyouUserAccount

  MoneyouPlatformAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Platform Account
      AccountId: '614335828775'
      Email: olaf.conijn@moneyou.nl

  MoneyouSecurityAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Security Account
      AccountId: '689483148385'
      Email: security-aws@moneyou.nl

  MoneyouComplianceAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Compliance Account
      AccountId: '939464272238'
      Email: moneyou-compliance-aws@moneyou.nl

  MoneyouLoggingAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Logging Account
      AccountId: '276478869702'
      Email: logging-aws@moneyou.nl

  MoneyouUserAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou User Account
      AccountId: '054949635754'
      Email: user-account-aws@moneyou.nl

  MoneyouTeam3DevelopmentAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Team 3 Development Account
      AccountId: '836623306256'
      Email: team3-dev-aws@moneyou.nl

  MoneyouTaiichiDevAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Taiichi Dev Account
      AccountId: '756303989147'
      Email: taiichi-dev-aws@moneyou.nl

  MoneyouDataDevelopmentAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Data Development Account
      AccountId: '855594205460'
      Email: data-dev-aws@moneyou.nl

  MoneyouSandboxDevAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Sandbox Dev Account
      AccountId: '098773402887'
      Email: sandbox-dev.aws@moneyou.nl

  Moneyou403DevAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou 403 Dev Account
      AccountId: '419664325495'
      Email: '403-dev-aws@moneyou.nl'

  MoneyouTeam2DevelopmentAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Team 2 Development Account
      AccountId: '912971329312'
      Email: team2-dev-aws@moneyou.nl

  MoneyouTeam1DevelopmentAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Team 1 Development Account
      AccountId: '579001564730'
      Email: team1-dev-aws@moneyou.nl

  MoneyouFreshDevelopmentAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Fresh Development Account
      AccountId: '227947473878'
      Email: fresh-dev-aws@moneyou.nl

  MoneyouAddressbookProductionAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Addressbook Production Account
      AccountId: '339539146431'
      Email: fresh-prod-aws@moneyou.nl

  MoneyouLimitsProductionAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Limits Production Account
      AccountId: '395788528074'
      Email: limits-prod-aws@moneyou.nl

  MoneyouXS2AProductionAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou XS2A Production Account
      AccountId: '889444667844'
      Email: xs2a-prod-aws@moneyou.nl

  MoneyouDataProductionAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Data Production Account
      AccountId: '274775030939'
      Email: data-prod-aws@moneyou.nl

  MoneyouAuthproductionAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Auth production Account
      AccountId: '030661853937'
      Email: auth-prod-aws@moneyou.nl

  MoneyouTransferBankProductionAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Transfer Bank Production Account
      AccountId: '419069893087'
      Email: transfer-bank-prod-aws@moneyou.nl

  Xs2a-devportalAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: xs2a-devportal
      AccountId: '451497838888'
      Email: xs2a-devportal-prod-aws@moneyou.nl

  MoneyouOnboardingProductionAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Onboarding Production Account
      AccountId: '672947131878'
      Email: onboarding-prod-aws@moneyou.nl

  MoneyouSnowplowProductionAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Snowplow Production Account
      AccountId: '255743039977'
      Email: snowplow-prod-aws@moneyou.nl

  MoneyouWalletsProductionAccount:
    Type: OC::ORG::Account
    Properties:
      AccountName: Moneyou Wallets Production Account
      AccountId: '031417794674'
      Email: wallets-prod-aws@moneyou.nl

  RestrictUnusedRegionsSCP:
    Type: OC::ORG::ServiceControlPolicy
    Properties:
      PolicyName: RestrictUnusedRegions
      Description: Restrict Unused regions
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
          -
            Sid: DenyUnsupportedRegions
            Effect: Deny
            NotAction:
              - 'cloudfront:*'
              - 'iam:*'
              - 'route53:*'
              - 'support:*'
            Resource: '*'
            Condition:
              StringNotEquals:
                'aws:RequestedRegion':
                  - eu-central-1
                  - eu-west-1
                  - us-east-1
        
  DenyUnsupportedRegionsSCP:
    Type: OC::ORG::ServiceControlPolicy
    Properties:
      PolicyName: DenyUnsupportedRegions
      Description: denies any action outside of the eu-central-1, eu-west-1 or us-east-1
      PolicyDocument:
        Version: '2012-10-17'
        Statement:
          -
            Sid: DenyUnsupportedRegions
            Effect: Deny
            NotAction:
              - 'cloudfront:*'
              - 'iam:*'
              - 'route53:*'
              - 'support:*'
            Resource: '*'
            Condition:
              StringNotEquals:
                'aws:RequestedRegion':
                  - eu-central-1
                  - eu-west-1
                  - us-east-1
        
Resources:

#  IamBaseLine:
#    Type: AWS::CloudFormation::Stack
#    OrganizationBindings:
#      Regions: eu-central-1
#      Accounts: '*'
#      IncludeMasterAccount: false
#    Properties:
#      TemplateURL: ./example.iam.baseline.yml
#      Parameters:
#        UsersAccount: !Ref UsersAccount

